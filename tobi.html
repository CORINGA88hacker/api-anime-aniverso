<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Editor de JSON GitHub</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Roboto', sans-serif;
    background: #1e1e2f;
    color: #f0f0f0;
    margin: 0;
    padding: 0;
  }

  .container {
    max-width: 900px;
    margin: 40px auto;
    padding: 20px;
    background: #2a2a3f;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.5);
  }

  h2 {
    text-align: center;
    color: #ff6b6b;
    margin-bottom: 30px;
  }

  label {
    display: block;
    margin-bottom: 10px;
    font-weight: 500;
    color: #f0f0f0;
  }

  select {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: none;
    margin-bottom: 20px;
    font-size: 16px;
    background: #3a3a5a;
    color: #f0f0f0;
  }

  textarea {
    width: 100%;
    height: 300px;
    padding: 15px;
    border-radius: 10px;
    border: none;
    background: #3a3a5a;
    color: #f0f0f0;
    font-family: 'Courier New', monospace;
    font-size: 14px;
    resize: vertical;
  }

  .buttons {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
  }

  button {
    padding: 12px 25px;
    font-size: 16px;
    font-weight: 500;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    background: #ff6b6b;
    color: #fff;
    transition: background 0.3s ease;
  }

  button:hover {
    background: #e55b5b;
  }

  @media (max-width: 600px) {
    .buttons {
      flex-direction: column;
    }

    button {
      width: 100%;
      margin-bottom: 10px;
    }
  }
</style>
</head>
<body>

<div class="container">
  <h2>Editor de JSON GitHub</h2>

  <label for="arquivoSelect">Escolha o arquivo:</label>
  <select id="arquivoSelect">
    <option value="animes.json">animes.json</option>
    <option value="episodios.json">episodios.json</option>
    <option value="temporadas.json">temporadas.json</option>
  </select>

  <textarea id="jsonEditor" placeholder="O conteúdo do JSON será carregado aqui..."></textarea>

  <div class="buttons">
    <button id="loadBtn">Carregar JSON</button>
    <button id="saveBtn">Salvar no GitHub</button>
  </div>
</div>

<script>
const token = "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";
const owner = "CORINGA88hacker";
const repo = "api-animes";
const branch = "main";

let currentSHA = "";

async function fetchJSON() {
  const arquivo = document.getElementById("arquivoSelect").value;
  const url = `https://api.github.com/repos/${owner}/${repo}/contents/${arquivo}?ref=${branch}`;

  const res = await fetch(url, {
    headers: {
      "Authorization": `token ${token}`,
      "Accept": "application/vnd.github.v3+json"
    }
  });

  const data = await res.json();
  if (data.content) {
    currentSHA = data.sha;
    const decoded = atob(data.content);
    document.getElementById("jsonEditor").value = decoded;
  } else {
    alert("Erro ao buscar arquivo: " + JSON.stringify(data));
  }
}

async function saveJSON() {
  const arquivo = document.getElementById("arquivoSelect").value;
  const novoConteudo = document.getElementById("jsonEditor").value;
  const base64Content = btoa(unescape(encodeURIComponent(novoConteudo)));
  const url = `https://api.github.com/repos/${owner}/${repo}/contents/${arquivo}`;

  const res = await fetch(url, {
    method: "PUT",
    headers: {
      "Authorization": `token ${token}`,
      "Accept": "application/vnd.github.v3+json"
    },
    body: JSON.stringify({
      message: `Atualizando ${arquivo} via editor web`,
      content: base64Content,
      sha: currentSHA,
      branch: branch
    })
  });

  const data = await res.json();
  if (data.content) {
    currentSHA = data.content.sha;
    alert(`${arquivo} atualizado com sucesso!`);
  } else {
    alert("Erro ao salvar: " + JSON.stringify(data));
  }
}

document.getElementById("loadBtn").addEventListener("click", fetchJSON);
document.getElementById("saveBtn").addEventListener("click", saveJSON);

// Carrega automaticamente o JSON selecionado na primeira vez
fetchJSON();
</script>

</body>
</html>
